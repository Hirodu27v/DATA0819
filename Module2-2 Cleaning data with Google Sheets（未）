Preparing Data - Cleaning data with Google Sheets
ここでは、Googleスプレッドシートの機能を使ってデータセットを整理し、分析や可視化に使えるようにする方法をご紹介します。
このビデオではBillboard200のサイトから上位200曲を集めて作ったデータを用います。曲の順位を見るためにE列を見に行って、「A-Eに並べ替える」を選択するとまず気付くことがあるはずです。
ミスがあることが分かりますか。データセットを２回インポートしたので（重複が）発生したのかもしれません。
重複を削除する方法を説明します。たくさんある重複を全て削除する必要があります。
とても優れた機能がデータタブにあります。「重複を削除」を選択するだけです。見出し行があることを指示して「重複を削除」をクリックします。
すると200個の重複を検出して削除します。とても簡単です。
ここにあるA、B列も削除したいと思います。Aをクリックしてshiftキーを押しながらBもクリックすると一緒に削除できました。ずっときれいになりました。
（ジャケット）画像のアドレスが完全でないことにお気付きでしょうか？ここにcharts-static.billboard.comとありますね。完全なように見えますが、ダブルスラッシュから始まっています。
全てのアドレス表記を揃えるにはhttps://を二重スラッシュに置き換えるか、その逆にします。
ここでは、二重スラッシュをhttps://に置き換えることにします。MacならCommand＋５か、Control、Command＋F、WindowsまたはLinuxの場合はControl＋Fを押します。
そうすると、このウィンドウが開きます。編集や検索、置換ができます。すでに特定の範囲を選択済みなので、ここでは二重スラッシュだけを置換します。
単に二重スラッシュを検索し、https://に置き換えると、すでに入力されているものはダブってしまいます。それは困ります。
ここで必要なのは、二重スラッシュから始まる行だけを置き換える方法です。web scraperでも使った正規表現を用いますが、今回はかなり簡単です。
このように（^を）入力してから"//"と打ち込み、「正規表現を使用した検索」ボックスがチェックされていることを確認します。
これを「https://」と記入して、全てを置き換えます。これであらゆる行に正しいアドレスが表示され、次に進む準備が整いました。
ところで、日付をキャプチャしたことを覚えていますか？現時点ではあまり役に立ちません。これを日付形式に変換することも、月、日、年に分割することもできます。
いくつかテクニックをお教えしましょう。最初は年を抽出します。年は右から１、２、３、４と４文字分あります。GoogleスプレッドシートにはRIGHTという関数があります。
"right"と入力して選択したい文字列を選択するだけで、右側から選択する文字数を取り出せます。この場合は4です。しかし、こうすると１年分しか抽出できません。
セルの右下隅のここをダブルクリックすると、下にある全てのセルに適用されます。月を抽出するのは"left"と呼ばれる別の関数です。"left"とタイプし、１、２、３、４、５、６。６文字です
左から６文字と指定すると、August、８月が抽出できました。また右下隅のここをダブルクリックすると、下のセルに適用できます。よくできました。
では、中央の日はどうやったら抽出できるでしょう。これは複合的なアプローチになります。推察の通り、"mid"関数を使って中間の文字を抽出します。
どの位置から始めたらいいのでしょうか。そう、ここで「31日」の位置を数える必要があります。1、2、3、4、5、6、7、8と数えて、そこから長さを２とすると31を得ます。
これを全てのセルに適用します。
これを簡単に行う別の関数が"SPLIT"関数です。この文字列を引数に、区切り記号を指定すると文字列を分解します。
この"August 31st, 2019"には間にスペースがあることに注目してください。このスペースを区切り記号として使用し、文字列を分割します。
引用符の間にスペースを入れて何が起こるか見てみましょう。自動的にこの値を3つの値に分割し、さらにここのカンマも無視することを確認してください。
この列をコピーして、新しい別の機能もご紹介します。「テキストを列に分割する」を選択すると区切り記号を自動的に検出し、別々の列に分割されます。
このように、値から情報を抽出し、独自のものにするためのアプローチがたくさんあります。年の列があり、日の列があります。そうしたらこれを削除してください。
週や年についての情報も得られたので、この列は削除することができます。この列です。これを削除できます。
これでデータ・セットが作成されました。データを整理し、分析や可視化をよりよいものにするための方法をいくつか試してみましょう。
Googleスプレッドシートに戻ってやってみましょう。
