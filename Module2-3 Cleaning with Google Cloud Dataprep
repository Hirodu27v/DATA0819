Preparing Data - Cleaning with Google Cloud Dataprep

乱雑なデータをクリーニングするいくつかの方法をご紹介します。サラ・コーエンの作った素晴らしい例を使いましょう。彼女はNYタイムズにいましたが、現在はアリゾナ大に籍を置いています。
それは2016年に開催されたコンピュータ支援報道の講義で発表されたものです。これは全てが含まれている優れた例です。
タイプミスや空白が含まれています。このデータはニューヨーク州の高齢者向け医療保険の長期管理ケア報告書から集められました。
ここにニューヨーク州の郡、次に総登録数、月と年の日付もありますが、さまざまな表記があって実に乱雑かつ質が低いものです。
それぞれのシートは月ごとに分けられていますが、彼女は全ての情報を一つのスプレッドシートにまとめました。
私たちはこのシートを加工して、このような見た目に仕上げたいと思います。
ある列にはプラン名、別の列には郡、登録数、月、年が表示されます。
各変数にはそれぞれの列が割り当てられています。合計値は必要ないので消去しています。
このビデオではGoogle data prepを使い、別のビデオではOpen refineで同じデータセットをクリーンアップする方法を説明します。
DataPrep by Trifactaは、Google Cloud Suiteの一部としてデータ分析やクリーニングを支援するツールです。
Dataprepは大量のデータセットを処理するのに適していますが、それだけでなく、データセットを素早く視覚化したり、クリーニングしたりするのに役立つアプリケーションでもあります。
何百万行ものデータセットにクリーニングルーチンを適用するときに大きな力を発揮します。しかし、サラの作った小さなデータセットにも使うことができます。
これは約6000行しかないので、それほど大きくありません。
さて、cloud.google.com/dataprepからコンソールに移動しましょう。アカウントを作成するよう促すメッセージに従ってアカウントを作ると、すぐこのようにアプリケーションをロードする画面に移動し、Dataprepを使い始めることができます。
ここで、データをインポートするためにファイルを選択します。このExcelファイルはフォーラムからダウンロードできるのでご心配なく。
ここをクリックすると起動し、アップロードが始まります。できましたか？自動的にExcelファイルであることを認識し、ファイルの中の特定のシートを読み込むことが表示されます。
"Import & Wrangle"をクリックするとすぐにファイルの処理を始めます。インターフェースはかなり直感的です。
このように複雑なデータセットの場合、ここにある多くのオプションを気にする必要はありませんが、気になりますよね。
上にある柱のようなものはカラムがないとか、値が一致しないということを通知してくれます。
クリックするだけで、列２に4000の欠損値があることが分かります。また、列４に一致しない値があることも見て取れます。さっきの完成形を見てみましょう。
プランの欄と、郡の欄と、それから登録、月、年の欄です。同じ順番でなくてもいいんです。まずすることはデータの抽出です。
年を取り出して、別の列を作りたいのです。ここでは2009を選択します。Dataprepは自動的に右側のメニューで、いくつかの操作を提案してくれます。
やりたいことは（年を表す）４桁の値を抽出することで、単に「2009」という数字を取り出すことではありません。
これで、抽出することができるようになりました。元の列は青、黄の列はこれから作成する列のプレビュー表示です。
2008、09、10、11、12、13、および14年の値が入ったカラムが作成されます。値の数も2008は12個、全体の18％などと表示されます。よければ"add"をクリックします。

 So it added a column here. I'm not going to worry about the names, I'm going to
rename all of the columns later. But now I want to extract the month, right? And to extract
a month I, I'm going to I'm going to go and just select a month here. But it's not gonna be
that easy, right? So with the year it was fairly easy but with a month here what we're going
to do is really to select the extract here but we're going to edit what's going on, and you
can select any of the actions.
So the column to extract from it is really column 2. And we're going to do, like a custom
text pattern. So I'm going to delete this and then I'm gonna say that's gonna start
extracting from "NYS", right? So there's always a NYS here before the month, and then it's
gonna be always before these four digits. Remember when we extracted the four digits so
we're gonna type here just the way they're indicating here. So digit and then four. All right.
So here it shows that it's extracting everything that I need actually more than I need
because it's extracting as well the spaces here that are around it and then the comma. But
we're gonna deal with that soon.
So I'm gonna add, and then it creates another column with the months. And I'm going to
do with this empty space here, I'm just going to select this empty space. And see how
Dataprep already suggests that we replace the values here, even this space before
January and after January with nothing. So we're just going to delete those empty spaces
for me. So I'm gonna select this one, now I'm going to click add. And then you see that
removed all of that. Now I'm going to remove the comma too, just find a comma and
replace with nothing, so you're gonna delete the comma. All right, so we have like a
column for months and a column for years.
But now see that we have the values here. So January is here and then we scroll down
January is here again with a different year. Then we'll keep scrolling down, we see
January again. So we want to, we want to make sure that all of these values here are filled
with January and all these values here are filled with 2009, until they get to 2010 and then
they get filled down again until they find the other year 2011. So on and so forth. This is
called a Fill Down and we can do this automatically in Dataprep just by using a new step.
So we're going to click on "new step" and then we're going to type here "window". And
then there is a former called "fill", and then we open parenthesis and then we select a
column. So we're gonna do first in the column 5, which is the column at the moment that
we're using for months. So I'm just going to type "fill" and then "column5". And then I'm
going to type here source number which is the row number in the original source file here.
So you type this and see that the blue column here which is the source becomes this
yellow column here. So January gets filled down until it finds a different value which is
February. So if I keep scrolling down until we find a different month it finds February then
until the end of the data set.
So I'm just going to add this here and then it will create another column here for us. This
will be our month column and I'm going to do the same with the year column so "new
step", "window", and then I'm gonna put "fill", and that's the column 1. Here I don't need
that, "column1" and then source number here, "sourcerownumber". And then, yes it
creates here another column for me that will be my year column. Now click "add". All right,
I have the county here, the enrollment here, the month, and the year, and the plan.
So it's starting to look like this thing that we want, but we still need to do a few things. So
the first thing that we're going to do after we created those columns we might want now to
rename all of them. So I'm going to rename this one, health plan. So, again I just clicked
on here on this arrow pointing downwards. Click "rename", and then I'm going to rename
just to "plan". I might want to do another thing with this one too, but I'm just gonna rename
that to plan. Same thing. This one actually I'm going to remove because I don't need it. I'm
also going to remove this one, "delete". Rename this to "county". This one rename to
"enrollments". All right. And this one to "month", and this one to "year".
All right, so now look at the visual representation here at the top. We can find the missing
values too and all of the mismatched values. But we're going to remove, start removing
like things like the total, right? We don't need this total, so we're just going to highlight it
and ask Dataprep to delete all of the rows that are matching "total" because we don't need
that.
Now we might want to do the same here with the health care plans, with the Medicaid
plans to fill down, right? Because we want this to be about the same plan that is here,
because if you take a look at the original table the group that Medicaid plans together and
have empty spaces to indicate they are the same. So we need to make sure that those are
filled down with the names of the plans too. So we're gonna go ahead and do that. And if
you remember, this is a new step. "Window", the formula is "fill", and then we go to "plan"
which is the name of the column now, and then "sourcerownumber". And then it creates a
new column here that has all of the values filled down.
I'm wanting, I want to delete this too and then move this one to the beginning. I'm going to
add and rename this one to "plan" again. All right, now I want to remove like all of the
missing values here because they, I mean they either have totals or they're about rows
that are not part of my data set, my final data sets. I'm just going to remove them. I'm also
going to take a look at mismatched values here, those mismatched values are those that
are not numbers. So I'm going to remove the mismatched values too, and there are
missing values here too that I want to remove.
So this is this is looking much more like the data set that we have here, and we completed
this in only twenty one steps. So this is, this is the final clean data set. So now what you
should do is, if you want to export this to a CSV file you actually select this option here to
"run job". So Dataprep will use its cloud infrastructure to get this recipe that you just
created and then apply it to the data sets that you imported. That's why it's so much more
powerful when you're dealing with massive data sets, but it can also do this with the small
one. You click on "run job", and then you check if everything is ok.
There are options here that you might want to select, for example I want to select that it
will create a CSV file and I have more options here that "include headers as first row on
creation" and then I update this. I'm going to select a location where it's going to save on
my cloud account. I select the regions and then I run the job. And as soon as the job is
done you will get a file a CSV file that is like this, I have it here with me as well. So here is
a CSV file that you might want to load. So this is it for the Dataprep. Go ahead and go to
cloud.google.dataprep and try it out.
